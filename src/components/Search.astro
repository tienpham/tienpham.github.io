---
// Search component using Pagefind
// Note: Search only works in production build (npm run build)
// Pagefind is not available in dev mode
---

<div id="search-container">
	<div id="search"></div>
	<noscript>
		<p>Search requires JavaScript to be enabled.</p>
	</noscript>
</div>

<style>
	#search-container {
		margin: 2em 0;
	}
	.search-notice {
		padding: 1em;
		background: #fef3c7;
		border-radius: 0.5em;
		color: #92400e;
		font-size: 0.875em;
	}
</style>

<script is:inline>
	// Load Pagefind script dynamically
	// Using is:inline to avoid Vite processing in dev mode
	const loadPagefind = async () => {
		try {
			// Dynamically create script tag to load Pagefind
			const script = document.createElement('script');
			script.src = '/pagefind/pagefind.js';
			script.type = 'module';

			script.onload = async () => {
				// Initialize Pagefind UI
				const searchElement = document.getElementById('search');
				if (searchElement && window.PagefindUI) {
					new window.PagefindUI({
						element: searchElement,
						showSubResults: true,
						showImages: false,
					});
				}
			};

			script.onerror = () => {
				// Pagefind not available (dev mode)
				const searchElement = document.getElementById('search');
				if (searchElement) {
					searchElement.innerHTML = '<div class="search-notice">⚠️ Search is only available in production build. Run <code>npm run build && npm run preview</code> to test.</div>';
				}
			};

			document.head.appendChild(script);
		} catch (error) {
			// Show dev mode notice
			const searchElement = document.getElementById('search');
			if (searchElement) {
				searchElement.innerHTML = '<div class="search-notice">⚠️ Search is only available in production build. Run <code>npm run build && npm run preview</code> to test.</div>';
			}
		}
	};

	// Load on page load
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', loadPagefind);
	} else {
		loadPagefind();
	}
</script>
